<ion-header>

  <ion-toolbar>
    <ion-buttons slot="start" class="ion-no-margin">
      <ion-menu-button color="light"></ion-menu-button> </ion-buttons>
    <ion-title color="light" class="ion-no-padding">
      <div class="vertical-align-content">
        <ion-icon color="light" (click)="goBack()" name="arrow-back"
          class="ion-padding-end ion-margin-start"></ion-icon>
        Κρατήσεις
      </div>
    </ion-title>
  </ion-toolbar>
  <div class="scrolling-wrapper backgroundChips">
    <ion-chip [class]="allChipClass" (click)="resetFilters()">
      Όλες
    </ion-chip> <ion-chip id="krathsh-trigger" (click)="openKrathshPopover()" [class]="krathshChip">
      <ion-label>Κατάσταση</ion-label>
      <ion-icon [color]="krathshChipIconCOlor" name="chevron-down-outline"></ion-icon> </ion-chip>
    <ion-popover trigger="krathsh-trigger" #krathshPop (ionPopoverDidDismiss)="closeKrathshPopover()">
      <ng-template>
        <ion-list class="backgroundGrid">
          <ion-item *ngFor="let item of itemsKrathsh" (click)="toggleItem(item)">
            <ion-label text-wrap>{{ item.value }}</ion-label>
            <ion-checkbox slot="end" [checked]="item.selected" ></ion-checkbox>
          </ion-item> </ion-list>
        <div class="button-container">
          <ion-button class="cancel-button" fill="outline" color="danger"
            (click)="closeKrathshPopover()">Άκυρο</ion-button> <ion-button class="apply-button" fill="solid"
            color="success" (click)="applyKrathshPopover()">Εφαρμογή</ion-button>
        </div>
      </ng-template>
    </ion-popover> <ion-chip class="not-selected-chip" (click)="searchKrathsh()">
      <ion-icon name="search-outline" color="light"></ion-icon>
      <ion-label>Αναζήτηση</ion-label>
    </ion-chip>
  </div>
</ion-header>
<ion-content *ngIf="initialized === false">
  <ion-spinner color="primary" class="ion-text-center ion-padding"></ion-spinner></ion-content>
<ion-content *ngIf="initialized" class="background">
  <ion-grid class="backgroundGrid">
    <ion-row class="ion-justify-content-center"> <ion-col size="12" class="ion-no-padding">
        <ion-grid class="ion-padding-top backgroundGrid">
          <ion-row>
            <ion-col offset="2" size="8">
              <ion-segment mode="ios" value="upcoming" (ionChange)="segmentChanged($event)">
                <ion-segment-button value="upcoming">
                  <ion-label>Επερχόμενες</ion-label>
                </ion-segment-button>
                <ion-segment-button value="new">
                  <ion-label>Όλες</ion-label>
                </ion-segment-button>
              </ion-segment>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <ion-grid class="npt">
    <ion-row class="ion-justify-content-center"> <ion-col size="12" class="ion-no-padding">


        <ion-item class="ion-padding-start -ion-padding-end " lines="none" *ngIf="krathseis.length==0">
          <ion-grid>
            <ion-row>
              <ion-img class="no_results_item" src="../../../assets/imgs/NoResults.svg"> </ion-img>
            </ion-row>
            <ion-row> <ion-note class="no_results_text">
                Δεν έχετε επερχόμενες κρατήσεις.
              </ion-note>
            </ion-row>
          </ion-grid> </ion-item> <ion-list class="ion-no-padding backgroundGrid">
          <ion-grid>
            <ng-container *ngFor="let krathsh of krathseis; let i = index" >

              <ion-chip *ngIf="mode === 'upcoming' && (i === 0 || getDate(krathsh[3]) !== getDate(krathseis[i-1][3]))"
                color="primary" class=" date-chip ion-margin-top">
                <ion-label>{{ getDate(krathsh[3]) }}</ion-label>
              </ion-chip>
              <ion-item  [class]="getColorForStatus(krathsh[2])" (click)="goToKrathsh(krathsh[0])">
                <ion-avatar class="custAvatarHed">
                  <ion-img src="data:image/jpeg;base64,{{krathsh[9]}}"></ion-img>
                </ion-avatar>
                <ion-label>
                  <h2 class="customFontHeader">{{krathsh[4]}}</h2>
                  <ion-note class="customFontNote" *ngIf="mode=='upcoming'">Ώρα:  {{getTime(krathsh[3])}} • Τιμή: €5</ion-note>
                  <ion-note class="customFontNote" *ngIf="mode=='new'">{{krathsh[3]}} • Τιμή: €5</ion-note>

                </ion-label>
                <div class="align-right" *ngIf="krathsh[2]=='Αποδεκτή'">
                  <ion-icon *ngIf="isMobile()" [color]="krathsh[7]=='true'?'success':'medium'" class="checkmark-icon"
                    name="checkbox-outline" (click)="checkIn(krathsh); $event.stopPropagation();"></ion-icon>
                   
            <ion-button *ngIf="!isMobile()"
                            class="rounded-btn align-right" [ngClass]="{'expanded': krathsh[7]=='checked_in'}"
                            [@buttonAnimation]="krathsh[7]=='true' ? 'expanded' : 'collapsed'"
                            [fill]="krathsh[7]=='true' ? 'solid' : 'outline'" size="small"
                            [class.green-border]="krathsh[7]!='true'" [color]="krathsh[7]=='true'?'success':'medium'"
                            (click)="checkIn(krathsh); $event.stopPropagation();"
                            style="text-transform: none; border-radius: 100px !important;">
                            <ion-icon *ngIf="krathsh[7]=='true'" [@checkmarkAnimation] name="checkmark-outline"
                              style="padding-right: 10px;"></ion-icon>
                            Έφτασε
                          </ion-button>
                </div>
              </ion-item>

            </ng-container>
            <!--<ng-container *ngFor="let krathsh of krathseis; let i = index">

              <ion-chip *ngIf="mode === 'upcoming' && (i === 0 || getDate(krathsh[3]) !== getDate(krathseis[i-1][3]))"
                color="primary" class=" date-chip">
                <ion-label>{{ getDate(krathsh[3]) }}</ion-label>
              </ion-chip> 
              
              <ion-row class="ion-margin-start ion-margin-end custRow">
                <ion-grid>
                  <ion-row class="ion-align-items-center borderBottom " (click)="goToKrathsh(krathsh[0])">
                    <ion-avatar class="custAvatarHed">
                      <ion-img src="data:image/jpeg;base64,{{krathsh[10]}}"></ion-img>
                    </ion-avatar>
                    <ion-grid class="custGrid">
                      <ion-row class="pb7">
                        <ion-col>
                          <ion-label class="f15 title" text-wrap>{{krathsh[5]}}</ion-label>
                          </ion-col>
                        <ion-col size="6"
                          *ngIf="mode=='upcoming' && krathsh[2] != 'Εκκρεμεί' && krathsh[2] != 'Ακυρώθηκε'"> <ion-button
                            class="rounded-btn align-right" [ngClass]="{'expanded': krathsh[7]=='checked_in'}"
                            [@buttonAnimation]="krathsh[7]=='true' ? 'expanded' : 'collapsed'"
                            [fill]="krathsh[7]=='true' ? 'solid' : 'outline'" size="small"
                            [class.green-border]="krathsh[7]!='true'" [color]="krathsh[7]=='true'?'success':'medium'"
                            (click)="checkIn(krathsh); $event.stopPropagation();"
                            style="text-transform: none; border-radius: 100px !important;">
                            <ion-icon *ngIf="krathsh[7]=='true'" [@checkmarkAnimation] name="checkmark-outline"
                              style="padding-right: 10px;"></ion-icon>
                            Έφτασε
                          </ion-button>
                        </ion-col>
                        <div class="align-right pt5" *ngIf="mode=='new'">
                          <ion-icon color="primary" name="calendar-outline" class="small-icon pr5"></ion-icon>
                          <ion-note class="pr10 ">{{ getDate(krathsh[3]) }}</ion-note>
                        </div>
                      </ion-row>
                      <ion-row>
                        <ion-chip [color]="getColorForStatus(krathsh[2])" class="chip-container ion-align-items-start"
                          *ngIf="krathsh[2]!='Εκκρεμεί'">
                          <ion-label>
                            {{krathsh[2]}}
                          </ion-label>
                          <div class="center">
                            <ion-spinner color="primary" name="crescent" *ngIf="!krathsh[2]"></ion-spinner>
                          </div>
                        </ion-chip>
                        <ion-chip class="chip-container2 ion-align-items-start" *ngIf="krathsh[2]=='Εκκρεμεί'"
                          (click)="openAcceptPopover(); $event.stopPropagation();">
                          <ion-label>
                            {{krathsh[2]}}
                          </ion-label>
                          <div class="center">
                            <ion-spinner color="primary" name="crescent" *ngIf="!krathsh[2]"></ion-spinner>
                          </div>
                          <ion-popover #acceptPop (ionPopoverDidDismiss)="closeAcceptPopover()">
                            <ng-template>
                              <ion-note style="text-align: center; padding: 20px;">
                                <p>Θέλετε να αποδεχτείτε την συγκεκριμένη κράτηση;</p>
                              </ion-note>
                              <div style="display: flex; justify-content: space-between; padding-top:30px;">
                                <ion-button fill="outline" color="danger" (click)="openRejectionPopover()">
                                  <ion-icon style="margin-right:3px;" name="close-circle-outline"></ion-icon>
                                  Απόρριψη
                                </ion-button>
                                <ion-button fill="solid" color="success" (click)="applyAcceptPopover(krathsh[0])">
                                  <ion-icon name="checkmark-circle-outline" style="margin-right:3px;"></ion-icon>
                                  Αποδοχή
                                </ion-button>
                              </div>
                            </ng-template>
                          </ion-popover>
                          <ion-popover #rejectPop (ionPopoverDidDismiss)="closeRejectPopover()">
                            <ng-template> <ion-textarea [counter]="true" maxlength="200" [autoGrow]="true"
                                class="cancelReason" label="Λόγος απόρριψης" labelPlacement="floating" fill="outline"
                                [value]="cancelReason"></ion-textarea>
                              <div class="scrolling-wrapper reasonChips">
                                <ion-chip outline color="primary" style="font-size: 12px;"
                                  (click)="appendToTextArea('Η ώρα που διαλέξατε δεν είναι διαθέσιμη. Παρακαλούμε κάντε μία νέα κράτηση.')">Μη
                                  διαθέσιμη ώρα</ion-chip>
                                <ion-chip outline color="secondary" style="font-size: 12px;"
                                  (click)="appendToTextArea('Λόγω ενός αναπάντεχου περιστατικού, αναγκαζόμαστε να ακυρώσουμε την κράτησή σας. Παρακαλούμε κάντε μία νέα κράτηση.')">Αναπάντεχο
                                  συμβάν</ion-chip>
                              </div>
                              <ion-button class="ion-margin-top" fill="solid" color="primary"
                                (click)="applyRejectPopover(krathsh[0])">
                                Αποστολή
                              </ion-button>
                            </ng-template>
                          </ion-popover>
                        </ion-chip>
                        <div class="pt">
                          <ion-icon color="primary" name="time-outline" class="small-icon pr5"></ion-icon>
                          <ion-note class="pr10">{{ getTime(krathsh[3]) }}</ion-note>
                          <ion-icon color="primary" name="person-outline" class="small-icon"></ion-icon>
                          <ion-note class="people-number">{{ krathsh[4] }}</ion-note>
                        </div>
                      </ion-row>
                    </ion-grid>
                  </ion-row>
                </ion-grid>
              </ion-row>
            </ng-container>-->
          </ion-grid> <ion-infinite-scroll threshold="0" (ionInfinite)="loadData($event)"
            [disabled]="disableInfiniteScroll">
            <ion-infinite-scroll-content loadingSpinner="crescent" loadingText="Φόρτωση περισσότερων...">
            </ion-infinite-scroll-content>
          </ion-infinite-scroll> </ion-list> </ion-col>
    </ion-row>
  </ion-grid><ion-fab class="float fabButton" (click)="newKrathsh()">
    <ion-chip class="ion-padding" class="bg">
      <ion-icon name="add-circle" color="light" class="f30"></ion-icon>
      <ion-label color="light">Νέα</ion-label>
    </ion-chip>
  </ion-fab></ion-content><ion-footer></ion-footer>